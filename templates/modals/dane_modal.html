{% macro dane_modal(modal_id, domain, validation_type, check_type, results_data, current_data_key, validation_state) %}
    <div id="{{ modal_id }}" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('{{ modal_id }}')">&times;</span>
            <h3>{{ validation_type }} Details - {{ domain }}</h3>

            <div class="tab-container">
                    <div class="tab-buttons">
                        {% if results_data.domain_ns %}
                            <button class="tab-button {% if current_data_key == 'domain_ns' %}active{% endif %}"
                                    onclick="showTab('{{ modal_id }}-domain-ns')">
                                <i class="fas fa-server"></i> Nameserver of Domain
                                {% set state = validation_state['Nameserver of Domain'] %}
                                {% if state.lower() == 'valid' %}
                                    <i class="fas fa-check-circle status-valid"></i>
                                {% elif state.lower() == 'partially-valid' %}
                                    <i class="fas fa-exclamation-triangle status-partially-valid"></i>
                                {% elif state.lower() == 'not-found' %}
                                    <i class="fas fa-question-circle status-not-found"></i>
                                {% else %}
                                    <i class="fas fa-times-circle status-not-found"></i>
                                {% endif %}
                            </button>
                        {% endif %}

                        {% if results_data.domain_mx %}
                            <button class="tab-button {% if current_data_key == 'domain_mx' %}active{% endif %}"
                                    onclick="showTab('{{ modal_id }}-domain-mx')">
                                <i class="fas fa-envelope"></i> Mail Server of Domain
                                {% set state = validation_state['Mail Server of Domain'] %}
                                {% if state.lower() == 'valid' %}
                                    <i class="fas fa-check-circle status-valid"></i>
                                {% elif state.lower() == 'partially-valid' %}
                                    <i class="fas fa-exclamation-triangle status-partially-valid"></i>
                                {% elif state.lower() == 'not-found' %}
                                    <i class="fas fa-question-circle status-not-found"></i>
                                {% else %}
                                    <i class="fas fa-times-circle status-not-valid"></i>
                                {% endif %}
                            </button>
                        {% endif %}

                        {% if results_data.mailserver_ns %}
                            <button class="tab-button {% if current_data_key == 'mailserver_ns' %}active{% endif %}"
                                    onclick="showTab('{{ modal_id }}-mailserver-ns')">
                                <i class="fas fa-server"></i> Nameserver of Mail Server
                                {% set state = validation_state['Nameserver of Mail Server'] %}
                                {% if state.lower() == 'valid' %}
                                    <i class="fas fa-check-circle status-valid"></i>
                                {% elif state.lower() == 'partially-valid' %}
                                    <i class="fas fa-exclamation-triangle status-partially-valid"></i>
                                {% elif state.lower() == 'not-found' %}
                                    <i class="fas fa-question-circle status-not-found"></i>
                                {% else %}
                                    <i class="fas fa-times-circle status-not-found"></i>
                                {% endif %}
                            </button>
                        {% endif %}
                    </div>

                    <!-- Nameserver of Domain Tab -->
                    {% if results_data.domain_ns %}
                        <div id="{{ modal_id }}-domain-ns"
                             class="tab-content {% if current_data_key == 'domain_ns' %}active{% endif %}">
                            <table class="details-table">
                                <thead>
                                <tr>
                                    <th>Server</th>
                                    <th>TLSA Records</th>
                                    <th>Validation</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for server, details in results_data.domain_ns.items() %}
                                    <tr>
                                        <td class="server-name">{{ server }}</td>
                                        <td>
                                            {% if details.tlsa_records and details.tlsa_records|length > 0 %}
                                                <ul class="record-list">
                                                    {% for record in details.tlsa_records %}
                                                        <li>
                                                            <span class="ip-address">{{ record }}</span>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <span class="status-not-found">No TLSA records found</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if details.tlsa_records and details.tlsa_records|length > 0 %}
                                                <span class="rpki-state {{ 'rpki-valid' if details.validation else 'rpki-invalid' }}">
                                                <i class="fas fa-{{ 'check-circle' if details.validation else 'times-circle' }}"></i>
                                                {{ 'Valid' if details.validation else 'Invalid' }}
                                            </span>
                                            {% else %}
                                                <span class="status-not-found">
                                                <i class="fas fa-question-circle"></i>
                                                N/A
                                            </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                    <!-- Mail Server of Domain Tab -->
                    {% if results_data.domain_mx %}
                        <div id="{{ modal_id }}-domain-mx"
                             class="tab-content {% if current_data_key == 'domain_mx' %}active{% endif %}">
                            <table class="details-table">
                                <thead>
                                <tr>
                                    <th>Server</th>
                                    <th>TLSA Records</th>
                                    <th>Validation</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for server, details in results_data.domain_mx.items() %}
                                    <tr>
                                        <td class="server-name">{{ server }}</td>
                                        <td>
                                            {% if details.tlsa_records and details.tlsa_records|length > 0 %}
                                                <ul class="record-list">
                                                    {% for record in details.tlsa_records %}
                                                        <li>
                                                            <span class="ip-address">{{ record.record }}</span>
                                                            <i class="fas fa-{{ 'check status-valid' if record.valid else 'times status-not-valid' }}"></i>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <span class="status-not-found">No TLSA records found</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if details.tlsa_records and details.tlsa_records|length > 0 %}
                                                <span class="rpki-state {{ 'rpki-valid' if details.validation else 'rpki-invalid' }}">
                                                <i class="fas fa-{{ 'check-circle' if details.validation else 'times-circle' }}"></i>
                                                {{ 'Valid' if details.validation else 'Invalid' }}
                                            </span>
                                            {% else %}
                                                <span class="status-not-found">
                                                <i class="fas fa-question-circle"></i>
                                                N/A
                                            </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                    <!-- Nameserver of Mail Server Tab -->
                    {% if results_data.mailserver_ns %}
                        <div id="{{ modal_id }}-mailserver-ns"
                             class="tab-content {% if current_data_key == 'mailserver_ns' %}active{% endif %}">
                            <table class="details-table">
                                <thead>
                                <tr>
                                    <th>Server</th>
                                    <th>TLSA Records</th>
                                    <th>Validation</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for server, details in results_data.mailserver_ns.items() %}
                                    <tr>
                                        <td class="server-name">{{ server }}</td>
                                        <td>
                                            {% if details.tlsa_records and details.tlsa_records|length > 0 %}
                                                <ul class="record-list">
                                                    {% for record in details.tlsa_records %}
                                                        <li>
                                                            <span class="ip-address">{{ record }}</span>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% else %}
                                                <span class="status-not-found">No TLSA records found</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if details.tlsa_records and details.tlsa_records|length > 0 %}
                                                <span class="rpki-state {{ 'rpki-valid' if details.validation else 'rpki-invalid' }}">
                                                <i class="fas fa-{{ 'check-circle' if details.validation else 'times-circle' }}"></i>
                                                {{ 'Valid' if details.validation else 'Invalid' }}
                                            </span>
                                            {% else %}
                                                <span class="status-not-found">
                                                <i class="fas fa-question-circle"></i>
                                                N/A
                                            </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
{% endmacro %}