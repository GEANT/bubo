<script>
    // Modal functions
    // Tab and Modal Management
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize the first tab as active
        showServiceTab('all');

        // Add click handlers for close buttons
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', function () {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Add click handlers for tab buttons
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function () {
                const tabId = this.getAttribute('data-tab');
                if (tabId) {
                    showTab(tabId);
                }
            });
        });

        // Close modal when clicking outside
        window.onclick = function (event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };
    });


    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) {
            console.error(`Modal with ID ${modalId} not found`);
            return;
        }

        // Hide all other modals first
        document.querySelectorAll('.modal').forEach(m => {
            m.style.display = 'none';
        });

        // Show this modal
        modal.style.display = 'block';

        // Find and show the first tab content
        const firstTabContent = modal.querySelector('.tab-content');
        if (firstTabContent) {
            const tabId = firstTabContent.id;
            showTab(tabId);
        }
    }


    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = 'none';
        }
    }

// Tooltip functions
function showTooltip(tooltipId) {
    const tooltip = document.getElementById(tooltipId);
    if (tooltip) {
        // Hide any other visible tooltips first
        document.querySelectorAll('.tooltip-content.visible').forEach(tip => {
            if (tip.id !== tooltipId) {
                tip.classList.remove('visible');
            }
        });

        // Show this tooltip
        tooltip.classList.add('visible');

        // Position the tooltip to ensure it's visible
        positionTooltip(tooltip);
    }
}

function hideTooltip(tooltipId) {
    const tooltip = document.getElementById(tooltipId);
    if (tooltip) {
        tooltip.classList.remove('visible');
    }
}

function positionTooltip(tooltip) {
    // Reset positioning first
    tooltip.style.left = '';
    tooltip.style.right = '';

    // Get tooltip position
    const rect = tooltip.getBoundingClientRect();

    // Check if tooltip extends beyond right edge of screen
    if (rect.right > window.innerWidth) {
        tooltip.style.left = 'auto';
        tooltip.style.right = '0';
    }

    // Check if tooltip extends beyond left edge of screen
    if (rect.left < 0) {
        tooltip.style.left = '0';
        tooltip.style.right = 'auto';
    }

    // Make sure tooltip is fully visible in the viewport
    const viewportHeight = window.innerHeight;
    if (rect.bottom > viewportHeight) {
        tooltip.style.top = 'auto';
        tooltip.style.bottom = '100%';
    }
}

// Hide all tooltips when switching tabs
function hideAllTooltips() {
    document.querySelectorAll('.tooltip-content.visible').forEach(tooltip => {
        tooltip.classList.remove('visible');
    });
}

// Modified showServiceTab function to handle tooltips
function showServiceTab(tabId) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active class from all buttons
    document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });

    // Show the selected tab
    const selectedTab = document.getElementById(`tab-${tabId}`);
    if (selectedTab) {
        selectedTab.classList.add('active');
    }

    // Add active class to the clicked button
    const clickedButton = document.querySelector(`.tab-button[onclick*="${tabId}"]`);
    if (clickedButton) {
        clickedButton.classList.add('active');
    }

    // Hide any visible tooltips when switching tabs
    hideAllTooltips();
}

// Handle modal tab changes as well to ensure tooltips work correctly
function showTab(tabId) {
    const tabElement = document.getElementById(tabId);
    if (!tabElement) {
        console.error(`Tab with ID ${tabId} not found`);
        return;
    }

    const modal = tabElement.closest('.modal-content');
    if (!modal) {
        console.error('Modal content container not found');
        return;
    }

    // Hide all tab contents in this modal
    modal.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active class from all tab buttons in this modal
    modal.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
    });

    // Show the selected tab
    tabElement.classList.add('active');

    // Activate the corresponding button
    const button = modal.querySelector(`[onclick*="${tabId}"]`);
    if (button) {
        button.classList.add('active');
    }

    // Hide any visible tooltips when switching modal tabs
    hideAllTooltips();
}

// Add event listeners for click outside tooltips to hide them
document.addEventListener('click', function(event) {
    // If the click wasn't on or inside a tooltip or info icon
    if (!event.target.closest('.tooltip-content') &&
        !event.target.closest('.info-icon')) {
        hideAllTooltips();
    }
});

// Initialize tooltip functionality on page load
document.addEventListener('DOMContentLoaded', function() {
    // Ensure info icons work in all tabs, not just the active one
    document.querySelectorAll('.info-icon').forEach(icon => {
        const tooltipId = icon.querySelector('.tooltip-content').id;

        // Ensure each tooltip has a unique ID
        const duplicate = document.querySelectorAll(`#${tooltipId}`);
        if (duplicate.length > 1) {
            console.warn(`Duplicate tooltip ID found: ${tooltipId}`);
        }

        // Add event listeners
        icon.addEventListener('mouseenter', function() {
            showTooltip(tooltipId);
        });

        icon.addEventListener('mouseleave', function() {
            hideTooltip(tooltipId);
        });
    });

    // Make sure tooltips in hidden tabs don't cause layout issues
    const tooltipStyle = document.createElement('style');
    tooltipStyle.textContent = `
        .tab-content:not(.active) .tooltip-content {
            pointer-events: none;
        }
    `;
    document.head.appendChild(tooltipStyle);
});
</script>